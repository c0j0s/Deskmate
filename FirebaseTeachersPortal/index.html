<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Teachers portal</title>
	<link rel="stylesheet" type = "text/css" href="css/bootstrap-grid.css">
	<link rel="stylesheet" type = "text/css" href="css/bootstrap-reboot.css">
	<link rel="stylesheet" type = "text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type = "text/css" href="css/styling.css">
	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.js"></script>
	

	<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script


  </head>
  <body>
	<div class="container">
		<h2 id="heading1">
			Welcome, Teachers
		</h2>
	
	<div id="data">
		
	</div>
		<div class="container">

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
		  <h4 class="modal-title">Modal Header</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          Paper Name:<input class="form-control input-sm" type="text" name="papername" id = "pName"></input>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" onclick="writetoDB()">Submit</button>
        </div>
      </div>
      
    </div>
  </div>
  
</div>
	</div>

    <script>
        
        //The Firebase SDK is initialized and available here!
		 var config = {
			apiKey: "AIzaSyB29exuhOXpePNSnW4UaGd8dhSppgYbYTo",
			authDomain: "deskmate2018.firebaseapp.com",
			databaseURL: "https://deskmate2018.firebaseio.com",
			projectId: "deskmate2018",
			storageBucket: "deskmate2018.appspot.com",
			messagingSenderId: "876434687063"
		};
			firebase.initializeApp(config);
        var studentProfileDb = firebase.database().ref('profile');
		studentProfileDb.once('value', getData)
		var questionDb;
		var qnsid = [];
		var curruser = "";
		var randomvalue;
		var a = [];
		var i = 0001;
		var	ranques = [];
		var index;	
		var	papername;
		var ids;		
		function randomques(id){
			questionDb = firebase.database().ref('question');
			questionDb.on('value', getQues)
			function getQues(question){
				question.forEach(function(quesSnapshot){
					var qesid = quesSnapshot.key;
					<!-- console.log(qesid); -->
					<!-- console.log(i); -->
					<!-- console.log(qesid == i); -->
						if (qesid == i){
							if(a.length < qnsid.length){
								if(qnsid.indexOf(qesid) === -1){
									a.push(quesSnapshot.key);
									console.log(a);
								}
							}
						}
						i++;
				})
			}
			return ids = $(id).data("user");
		}
		function writetoDB(){
		console.log(ids);
		papername = document.getElementById('pName').value;
		console.log(papername);
				for (var c = 0; c < 4; c++){
					randomvalue = a[Math.floor(Math.random() * a.length)];
					index = a.indexOf(randomvalue);
					ranques.push(randomvalue);
					console.log(ranques);
					a.splice(index,1);
				}
			firebase.database().ref('profile/'+ids+'/homework').push({
				status: "not completed",
				attempts: 0,
				name: papername,
				score: 0,
				totalScore: 100,
				questions:{
					0:{
						id:ranques[0],
						status:"",
						stuAns:"",
						tryCount:""
					},
					1:{
						id:ranques[1],
						status:"",
						stuAns:"",
						tryCount:""
					},
					2:{
						id:ranques[2],
						status:"",
						stuAns:"",
						tryCount:""
					},
					3:{
						id:ranques[3],
						status:"",
						stuAns:"",
						tryCount:""
					}
				}
				
			})
			}
		function getData(data){
			data.forEach(function(childSnapshot){
				var userkey = childSnapshot.key;
				//console.log(childSnapshot);
					$('<div class= "card bg-light mb-3"><div id="heading2" class="card-header"><b>Name: '+childSnapshot.val().name+'</b><button class="btn call" data-user="'+userkey+'" id ="'+userkey+'" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" onclick="randomques(this)">Generate Question</button></div><div class="card-body scrollmenu"><div class="card-deck child inline" id="details'+userkey+'"></div></div></div><p></p>').appendTo("#data");
						childSnapshot.child("homework").forEach(function(hwsnapshot){
						//console.log(childSnapshot.val());
								$('<div class="card text-white bg-secondary mb-3 one"><div class="heading4 card-header">'+hwsnapshot.val().name+'<div class="score"><b>'+hwsnapshot.val().score+'/100</b></div></div><div id="'+hwsnapshot.key+'" class="card-body"></div></div></div>').appendTo('#details'+userkey);
								hwsnapshot.child("questions").forEach(function(qnssnapshot){
									$('<div id="Q'+qnssnapshot.val().id+hwsnapshot.key+'"><p class="container-fluid heading3 card-text">No of Tries: '+qnssnapshot.val().tryCount+'</p><p class="container-fluid heading3 card-text" >Student Answer: '+qnssnapshot.val().stuAns+'</p></div>').appendTo('#'+hwsnapshot.key);
									questionDb = firebase.database().ref('question');
									questionDb.once('value', getQues)
									function getQues(question){
									//console.log(question);
									
										question.forEach(function(quesSnapshot){
											var qesid = quesSnapshot.key;
												if( qesid === qnssnapshot.val().id){
													$('<p class="heading3 card-text"><b>'+quesSnapshot.val().question+'</b></p>').prependTo('#Q'+ qnssnapshot.val().id+hwsnapshot.key);
													$("#"+userkey).on('click',function() {
														if(curruser == $(this).data("user")){
															qnsid.push(qesid);
															console.log(qnsid);
														}
														else{
															qnsid = [];
															curruser = $(this).data("user")
															//console.log(curruser);
															qnsid.push(qesid);
															console.log(qnsid);
														}
													})
													
												}
										})
										
									}
								})
						})
			})
		}
		
    </script>
  </body>
</html>
