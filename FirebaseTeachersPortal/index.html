<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Teachers portal</title>
	<link rel="stylesheet" type = "text/css" href="css/bootstrap-grid.css">
	<link rel="stylesheet" type = "text/css" href="css/bootstrap-reboot.css">
	<link rel="stylesheet" type = "text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type = "text/css" href="css/styling.css">
	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.js"></script>
	

	<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script


  </head>
  <body>
	<div class="container">
		<h2 id="heading1">
			Welcome, Teachers
		</h2>
	
	<div id="data">
		
	</div>
	</div>

    <script>
        
        //The Firebase SDK is initialized and available here!
		 var config = {
			apiKey: "AIzaSyB29exuhOXpePNSnW4UaGd8dhSppgYbYTo",
			authDomain: "deskmate2018.firebaseapp.com",
			databaseURL: "https://deskmate2018.firebaseio.com",
			projectId: "deskmate2018",
			storageBucket: "deskmate2018.appspot.com",
			messagingSenderId: "876434687063"
		};
			firebase.initializeApp(config);
        var studentProfileDb = firebase.database().ref('profile');
		studentProfileDb.on('value', getData)
		var questionDb;
		
		function randomques(id){
		var id = $(id).data("user")
		console.log(id);
					var i = 0001;
					var a = [];
			questionDb = firebase.database().ref('question');
			questionDb.on('value', getQues)
			function getQues(question){
				question.forEach(function(quesSnapshot){
					var qesid = quesSnapshot.key;
					console.log(qesid);
						if (qesid == i){
							a.push(quesSnapshot.key);
							console.log(a);
							i++;
						}
						
				})
			}
			firebase.database().ref('profile/'+id+'/homework').push({
				name: "paper2",
				score: 0,
				totalScore: 100,
				questions:{
					0:{
						id:a[0],
						status:"",
						stuAns:"",
						tryCount:""
					},
					1:{
						id:a[1],
						status:"",
						stuAns:"",
						tryCount:""
					},
					2:{
						id:a[2],
						status:"",
						stuAns:"",
						tryCount:""
					},
					3:{
						id:a[3],
						status:"",
						stuAns:"",
						tryCount:""
					}
				}
				
			})
		}
		function getData(data){
			data.forEach(function(childSnapshot){
				var userkey = childSnapshot.key;
					$('<div class= "card" id="style"><div class="card-body" id="details"><p id="heading2"><b>'+childSnapshot.val().name+'</b><button class="btn call" data-user="'+userkey+'" onclick="randomques(this)">Generate Question</button></div></div><p></p>').appendTo("#data");
						childSnapshot.val().homework.forEach(function(hwsnapshot){
						//console.log(hwsnapshot.score);
						if(typeof hwsnapshot.score === "undefined"){
							$('<div id="'+userkey+'"><p class="heading4">'+hwsnapshot.name+'</p><p class="container-fluid">Homework Score: <b>0/100</b></p></div>').appendTo('#details');
							hwsnapshot.questions.forEach(function(qnssnapshot){
									$('<div id="Q'+qnssnapshot.id+'"><p class="container-fluid" class="heading3">No of Tries: '+qnssnapshot.tryCount+'</p><p class="container-fluid" class="heading3">Student Answer: '+qnssnapshot.stuAns+'</p></div>').appendTo('#'+userkey);
									questionDb = firebase.database().ref('question');
									questionDb.on('value', getQues)
									function getQues(question){
										question.forEach(function(quesSnapshot){
											var qesid = quesSnapshot.key;
												if( qesid === qnssnapshot.id){
													$('<p class="heading3">'+quesSnapshot.val().question+'</p>').prependTo('#Q'+ qnssnapshot.id);
												}
										})
									}
								})
						}
						else{
								$('<div id="'+userkey+'"><p class="heading4">'+hwsnapshot.name+'</p><p class="container-fluid">Homework Score: <b>'+hwsnapshot.score+'</b></p></div>').appendTo('#details');
								hwsnapshot.questions.forEach(function(qnssnapshot){
									$('<div id="Q'+qnssnapshot.id+'"><p class="container-fluid" class="heading3">No of Tries: '+qnssnapshot.tryCount+'</p><p class="container-fluid" class="heading3">Student Answer: '+qnssnapshot.stuAns+'</p></div>').appendTo('#'+userkey);
									questionDb = firebase.database().ref('question');
									questionDb.on('value', getQues)
									function getQues(question){
										question.forEach(function(quesSnapshot){
											var qesid = quesSnapshot.key;
												if( qesid === qnssnapshot.id){
													$('<p class="heading3">'+quesSnapshot.val().question+'</p>').prependTo('#Q'+ qnssnapshot.id);
												}
										})
									}
								})
							}
						})
			})
		}
		
    </script>
  </body>
</html>
