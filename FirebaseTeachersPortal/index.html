<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Teachers portal</title>
	<link rel="stylesheet" type = "text/css" href="css/bootstrap-grid.css">
	<link rel="stylesheet" type = "text/css" href="css/bootstrap-reboot.css">
	<link rel="stylesheet" type = "text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type = "text/css" href="css/styling.css">
	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.js"></script>
	

	<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script


  </head>
  <body>
	<div class="container">
		<h2 id="heading1">
			Welcome, Teachers
		</h2>
	
	<div id="data">
		
	</div>
	</div>

    <script>
        
        //The Firebase SDK is initialized and available here!
		 var config = {
			apiKey: "AIzaSyB29exuhOXpePNSnW4UaGd8dhSppgYbYTo",
			authDomain: "deskmate2018.firebaseapp.com",
			databaseURL: "https://deskmate2018.firebaseio.com",
			projectId: "deskmate2018",
			storageBucket: "deskmate2018.appspot.com",
			messagingSenderId: "876434687063"
		};
			firebase.initializeApp(config);
        var studentProfileDb = firebase.database().ref('profile');
		studentProfileDb.once('value', getData)
		var questionDb;
		var qnsid = [];
		var curruser = "";
		function randomques(id){
		var id = $(id).data("user")
		//console.log(qnsid.length);
					var a = [];
					var i = 0001;
			questionDb = firebase.database().ref('question');
			questionDb.on('value', getQues)
			function getQues(question){
				question.forEach(function(quesSnapshot){
					var qesid = quesSnapshot.key;
					<!-- console.log(qesid); -->
					<!-- console.log(i); -->
					<!-- console.log(qesid == i); -->
						if (qesid == i){
							if(a.length < qnsid.length){
								if(qnsid.indexOf(qesid) === -1){
									a.push(quesSnapshot.key);
									console.log(a);
								}
							}
						}
						i++;
				})
			}
			<!-- firebase.database().ref('profile/'+id+'/homework').push({ -->
				<!-- name: "paper2", -->
				<!-- score: 0, -->
				<!-- totalScore: 100, -->
				<!-- questions:{ -->
					<!-- 0:{ -->
						<!-- id:a[0], -->
						<!-- status:"", -->
						<!-- stuAns:"", -->
						<!-- tryCount:"" -->
					<!-- }, -->
					<!-- 1:{ -->
						<!-- id:a[1], -->
						<!-- status:"", -->
						<!-- stuAns:"", -->
						<!-- tryCount:"" -->
					<!-- }, -->
					<!-- 2:{ -->
						<!-- id:a[2], -->
						<!-- status:"", -->
						<!-- stuAns:"", -->
						<!-- tryCount:"" -->
					<!-- }, -->
					<!-- 3:{ -->
						<!-- id:a[3], -->
						<!-- status:"", -->
						<!-- stuAns:"", -->
						<!-- tryCount:"" -->
					<!-- } -->
				<!-- } -->
				
			<!-- }) -->
		}
		function getData(data){
			data.forEach(function(childSnapshot){
				var userkey = childSnapshot.key;
				//console.log(childSnapshot);
					$('<div class= "card" id="style"><div class="card-body" id="details'+userkey+'"><p id="heading2"><b>'+childSnapshot.val().name+'</b><button class="btn call" data-user="'+userkey+'" id ="'+userkey+'" onclick="randomques(this)">Generate Question</button></div></div><p></p>').appendTo("#data");
						childSnapshot.child("homework").forEach(function(hwsnapshot){
						//console.log(childSnapshot.val());
								$('<div id="'+hwsnapshot.key+'"><p class="heading4">'+hwsnapshot.val().name+'</p><p class="container-fluid">Homework Score: <b>'+hwsnapshot.val().score+'</b></p></div>').appendTo('#details'+userkey);
								hwsnapshot.child("questions").forEach(function(qnssnapshot){
									$('<div id="Q'+qnssnapshot.val().id+hwsnapshot.key+'"><p class="container-fluid" class="heading3">No of Tries: '+qnssnapshot.val().tryCount+'</p><p class="container-fluid" class="heading3">Student Answer: '+qnssnapshot.val().stuAns+'</p></div>').appendTo('#'+hwsnapshot.key);
									questionDb = firebase.database().ref('question');
									questionDb.once('value', getQues)
									function getQues(question){
									//console.log(question);
									
										question.forEach(function(quesSnapshot){
											var qesid = quesSnapshot.key;
												if( qesid === qnssnapshot.val().id){
												console.log(curruser);
													$('<p class="heading3">'+quesSnapshot.val().question+'</p>').prependTo('#Q'+ qnssnapshot.val().id+hwsnapshot.key);
													$("#"+userkey).on('click',function() {
														if(curruser == $(this).data("user")){
															qnsid.push(qesid);
															console.log(qnsid);
														}
														else{
															qnsid = [];
															curruser = $(this).data("user")
															console.log(curruser);
															qnsid.push(qesid);
															console.log(qnsid);
														}
													})
													
												}
										})
										
									}
								})
						})
			})
		}
		
    </script>
  </body>
</html>
